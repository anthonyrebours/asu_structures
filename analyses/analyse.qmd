---
title: "Untitled"
format: html
---

```{r}
# Packages
pacman::p_load(
  tidyverse, 
  ggraph, 
  igraph,
  ggforce,
  vite, 
  tidygraph,
  biblionetwork,
  widyr
)

asu_structures <- rio::import(here::here("data", "asu_structures.xlsx"))

asu_membres <- 
  c(
    "Sorbonne Université", 
    "Muséum national d'Histoire naturelle",
    "Conservatoire National des Arts et Métiers",
    "Université de Technologie de Compiègne",
    "INSEAD"
  )

udice <- 
  c(
    "Aix-Marseille Université",
    "Université Claude Bernard Lyon 1",
    "Institut Polytechnique de Paris", 
    "Université Côte d'Azur", 
    "Université de Lorraine",
    "Université Grenoble Alpes", 
    "Université Paris Cité",
    "Université Paris-Saclay",
    "Université Paris Sciences et Lettres", 
    "Université de Bordeaux", 
    "Université de Montpellier", 
    "Université de Strasbourg"
  )
```



```{r}
asu_etablissements <- 
  asu_structures %>% 
  filter(
    etablissement_relations == "parent" 
    & etablissement_type != "government"
  ) 

edges <- 
  asu_etablissements %>%
  pairwise_count(etablissement, structure, upper = FALSE) %>% 
  filter(item1 %in% asu_membres)

nodes <- 
  asu_etablissements %>%
  distinct(etablissement) %>% 
  filter(
    etablissement %in% edges$item1 | etablissement %in% edges$item2
  ) %>% 
  mutate(
    reseau = case_when(
      etablissement %in% asu_membres ~ "asu",
      etablissement %in% udice ~ "udice",
      TRUE ~ "autre"
    )
  )
  
edges %>% 
  graph_from_data_frame(vertices = nodes) %>% 
  ggraph(layout = "fr") +
  geom_edge_link(aes(edge_alpha = n, width = n), alpha = 0.3) +
  scale_edge_width_continuous(range = c(0.1, 2)) +
  geom_node_point(
    aes(
      colour = reseau, 
      size = ifelse(
        reseau == "asu", 
        5, 
        3
      )
    )
  ) +
  scale_colour_discrete("set2") +
  geom_node_text(
    aes(
      label = ifelse(centrality_degree() > 1, name, NA),
      size = centrality_degree()
    )
  ) +
  theme_void() +
  theme(legend.position = "none") +
  coord_cartesian(clip = "off") +
  ragg::agg_png(
    here::here("analyses", "co_tutelles_network.png"),
    res = 500,
    width = 8, 
    height = 7, 
    units = "in"
  )
```

![](co_tutelles_network.png){.lightbox}

<br>

```{r}
su_structures <- 
  asu_structures %>% 
  filter(
    etablissement == "Sorbonne Université"
  ) 

edges <-
  su_structures %>% 
  select(structure, etablissement, etablissement_relations)

edges %>% 
  graph_from_data_frame() %>% 
  ggraph(layout = "stress") +
  geom_edge_link() +
  geom_node_point() +
  geom_node_text(aes(label = name)) +
  theme_void() +
  theme(legend.position = "none")
```

